variant: fcos
version: 1.5.0
systemd:
  units:
    - name: qemu-guest-agent.service
      enabled: true
      contents: |
        [Unit]
        Description=Run qemu guest agent
        After=default.target

        [Service]
        ExecStartPre=mkdir -p /var/lib/qemu-guest-agent
        ExecStartPre=/usr/bin/docker kill qemu-ga
        ExecStartPre=/usr/bin/docker rm qemu-ga
        ExecStartPre=/usr/bin/docker pull nkcx/qemu-guest-agent
        ExecStart=/usr/bin/docker run -d --privileged -v /dev/virtio-ports/org.qemu.guest_agent.0:/dev/virtio-ports/org.qemu.guest_agent.0 nkcx/qemu-guest-agent
        ExecStart=/usr/bin/docker run --rm --name qemu-ga --privileged -v /dev:/dev -v /bin/systemctl:/bin/systemctl -v /run/systemd/system:/run/systemd/system -v /var/run/dbus/system_bus_socket:/var/run/dbus/system_bus_socket -v /sys/fs/cgroup:/sys/fs/cgroup --ipc=host --net=host qemu-guest-agent:dev1
        ExecStart=/usr/bin/docker run --rm --name qemu-ga --privileged -v /dev:/dev -v /run/dbus:/run/dbus --ipc=host --net=host qemu-guest-agent:dev1
        ExecStart=/usr/bin/docker run --rm --name qemu-ga --privileged -v /dev:/dev -v /run/dbus:/run/dbus -v /run/systemd:/run/systemd --pid=host --ipc=host --net=host qemu-guest-agent:debslim1
        ExecStop=/usr/bin/docker stop qemu-ga

        [Install]
        WantedBy=multi-user.target
passwd:
  users:
    - name: reesericci
      password_hash: $y$j9T$PXcOUHzBWH43oFsHsyasD/$nmp3XmDQiAq3xlIN.rX49zA/UtDzmlJzlGSVsie6U4/
      groups:
        - wheel
        - sudo
      ssh_authorized_keys:
        - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDtJXJ1jH0J8/JseqadIYP2TkzqMQHTJWm7D7ycYnZP8IbYspyoCKheIkGkkW7pMSnK29KwvVWg4VN0vn+kGLbOu8fgoudGNkHgW8rt+/T7DdmjXWEoCOp4Sv8HIjANt/mbGLr8a7mF/fb/EvvOGuJHt0qb9dlrO227tXwLrs1isOqZiA55gFI56ua3gg0SIW7enJiNGx5AE8toeL9MZIA2cuSiCWoe1V8yidCk5bcXNZQdJtjtlHzXU9TfRGE3lwALsLZG7gbU6ww3t0YC9WcV9JsCCsj1vlMU3B5N6ElRVKkFNJS1BgGtN80VkWIgBQlEru6Vdjs7UaPHrO2lnvRpxC4hxMk5PmMP5iIqsiwwQabN93tqIuuiTG6VF7GTFcDxfwUv6s8JiDQEtif/Li5aKfoH0DoJRm2+drijFbZBFgU55DENLRvKynOG5lkmjcQ34D5ZHDpaZgMciK7IatojtIWzQRQ0RtTWwrY/RmN84Kx43s2bnko16+Bz4lpH2aU= reesericci@poptop
kernel_arguments:
  should_exist:
    - coreos.first_boot=1
